#!/usr/bin/env python3

import os
import re
import sys
import time

from datetime import datetime


def ring():
    print("", end='\r', flush=True)
    os.system("afplay /System/Library/Sounds/Purr.aiff")


def check(truth):
    if not truth:
        print("e.g. usage: timer 1h30m5s")
        sys.exit(1)

check(len(sys.argv) == 2)

time_re = re.compile(r"(?:(\d*)h)?(?:(\d*)m)?(?:(\d)*s)?")
match = time_re.match(sys.argv[1])
check(match)

hh = int(match.group(1)) if match.group(1) else 0
mm = int(match.group(2)) if match.group(2) else 0
ss = int(match.group(3)) if match.group(3) else 0
check(hh >= 0 and mm >= 0 and ss >= 0)

time_remain = hh * 3600 + mm * 60 + ss
time_curr = datetime.now().strftime('%H:%M:%S')

info_str = "Started timer at %s for " % time_curr
if hh:
	info_str += "%d hours " % hh
if mm:
	info_str += "%d minutes " % mm
if ss:
	info_str += "%s seconds " % ss
print (info_str)

while (time_remain >= 0):
    hh = time_remain / 3600
    mm = (time_remain % 3600) / 60
    ss = (time_remain % 60)
    print (
    	"\033[104m%.2d:%.2d:%.2d\033[0m" % (hh, mm, ss),
    	end="\r", flush=True
    )
    time.sleep(1)
    time_remain -= 1

ring()



